<!DOCTYPE html>
<html>
<head>
<!--script src="music.js"></script-->
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<script src="Music.js"></script>
<script src="MusicGame.js"></script>
<script>

const outputScaleOptions = () => {
    let scaleEl = document.getElementById('scale');
    scaleEl.innerHTML = '';
    let music = new Music();
    Object.keys(music.scales).forEach( (k) => {
        let opt = document.createElement('option');
        opt.value = k;
        opt.innerHTML = k;
        scaleEl.appendChild(opt);
    })
}

var context = new AudioContext();

//LITTLE HELPER FUNCTION TO CALL THE MUSIC CLASS
playMusicalScale = () => {
    //GET THE SELECTED KEY AND SCALE NAME
    let key = document.getElementsByName('key')[0].value;
    let scale = document.getElementsByName('scale')[0].value;
    let duration = document.getElementsByName('duration')[0].value;
    let basePitch = document.getElementsByName('basePitch')[0].value;
    //GET AN INSTANCE OF THE MUSIC CLASS
    let music = new Music();
    //SET THE BASE PITCH
    music.setBasePitch(basePitch);
    //PLAY THE SELECTED SCALE (AudioContext)
    music.playScale(key, scale, duration);
    //GET THE NOTES OF THIS SCALE TO OUTPUT TO THE SCREEN
    let scaleNotes = music.getScaleNotes(key,scale);
    //OUTPUT NOTES TO SCALE NOTES DIV
    document.getElementById('scaleNotesDiv').innerHTML = 'NOTES: ' + scaleNotes.join(" ");
}

const init = () => {
    outputScaleOptions();
    showTab('gameSetup');
}

const playGame = () => {
    console.log('game started!');
    let game = new MusicGame();
    const gameType = document.getElementById('gameType').value;
    game.setType(gameType);
    const difficulty = document.getElementById('difficulty').value;
    game.setDifficulty(difficulty);
    game.start();
    showTab('game');
}

const showTab = (tabName) => {
    const tabs = document.getElementsByClassName('tab');
    for(let i = 0; i < tabs.length; i++){
        tabs[i].style.display = 'none';
    }
    document.getElementById(tabName).style.display = 'block';
}
</script>

<style>
    * {
        background: #333;
        color: #fff;
        font-size: 1.2em;
    }
    body {
        margin: 1% 5%;
    }
    input, select{
        background: #ddd;
        color: #000;
        width: 90%;
        height: 2em;
        margin: 0 5%;
    }
    button {
        background: green;
        color: white;
        width: 90%;
        margin: 10px 5%;
    }
    button.nav {
        font-size: 1.0em;
        width: auto;
        position: relative;
        margin: 0 5%;
    }
    h1 { 
        margin: 2px 5%;
    }
    h4 {
        padding: 0;
        margin: 0;
    }
    #navbar {
        background-color: #000;
    }
</style>

</head>
<body onload="init()">
    
    <h1>Music Playground</h1>
    
    <menu id="navbar">
        <button class="nav" onclick="showTab('scales')">Playground</button>
        <button class="nav" onclick="showTab('gameSetup')">Game</button>
    </menu>
    
    <section id="scales" style="display: block;" class="tab">
        Key: 
        <select name="key">
                <option value="C">C</option>
                <option value="Db">Db</option>
                <option value="D">D</option>
                <option value="Eb">Eb</option>
                <option value="E">E</option>
                <option value="F">F</option>
                <option value="Gb">Gb</option>
                <option value="G">G</option>
                <option value="Ab">Ab</option>
                <option value="A">A</option>
                <option value="Bb">Bb</option>
                <option value="B">B</option>
        </select>

        <br><br>

        Scale: 
        <select id="scale" name="scale">
                <!-- filled by outputScaleOptions -->
        </select>

        <br><br>

        Duration (ms): 
        <input name="duration" type="number" value="200"/>

        <br><br>

        Base Pitch - Concert Pitch A4 = 440 (Hz): 
        <input name="basePitch" type="number" value="440" step=".01"/>

        <br><br>

        <button id="playScale" onclick="playMusicalScale()">Play Scale</button>

        <br><br>

        <div id="scaleNotesDiv">
        </div>
        
    </section>
    
    <section id="gameSetup" style="display: block;" class="tab">
        
        <h2>Game Setup</h2>
        
        Game Type: 
        <select id="gameType" name="gameType">
            <option value="key">Key Guess </option>
            <option value="scale" selected>Scale Guess</option>
            <option value="pitch">Pitch Guess</option>
        </select>
        
        Difficulty: 
        <select id="difficulty" name="difficulty ">
            <option value="easy">Easy</option>
            <option value="medium" selected>Medium</option>
            <option value="hard">Hard</option>
        </select>
        
        <br><br>
        
        <button onclick="playGame()">Play Game</button>
        
    </section>
    
    <section id="game" style="display: none;" class="tab">
        <!--h2>Game</h2-->
        <div id="gameOutput">
            
        </div>
    </section>
</body>
</html>